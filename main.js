(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r),e.addEventListener("click",o)}function n(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r),e.removeEventListener("click",o)}e.d({},{Kw:()=>E,MB:()=>x,Iv:()=>V,Yl:()=>P,yE:()=>w,eu:()=>T,my:()=>j,In:()=>U,kq:()=>B,cb:()=>z,iW:()=>y});var r=function(e){var t=document.querySelector(".popup_opened");"Escape"===e.key&&n(t)},o=function(e){e.target===e.currentTarget&&n(e.currentTarget)},c={baseUrl:"https://mesto.nomoreparties.co/v1/cohort-14",headers:{authorization:"7d44fa7e-04ef-41d7-b07e-efc6bd06cf53","Content-Type":"application/json"}},a=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},i={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input_type_visible"},u=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(i.inputErrorClass),n.classList.remove(i.errorClass),n.textContent=""};function l(e){Array.from(e.querySelectorAll(i.inputSelector)).forEach((function(t){u(e,t)})),e.reset()}var s=function(e,t){d(e)?function(e,t){e.setAttribute("disabled","true"),e.classList.add(t.inactiveButtonClass)}(t,i):function(e,t){e.removeAttribute("disabled"),e.classList.remove(t.inactiveButtonClass)}(t,i)},d=function(e){return e.some((function(e){return!e.validity.valid}))};function f(){Array.from(document.querySelectorAll(i.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(i.inputSelector)),n=e.querySelector(i.submitButtonSelector);s(t,n),t.forEach((function(r){r.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(i.inputErrorClass),r.textContent=n,r.classList.add(i.errorClass)}(e,t,t.validationMessage)})(e,r),s(t,n)}))}))}(e)}))}var p=null;function m(e){var n=function(e){var n=V.content.querySelector(".cards__item").cloneNode(!0),r=n.querySelector(".cards__description"),o=n.querySelector(".cards__image"),i=n.querySelector(".cards__delete"),u=n.querySelector(".cards__like-counter"),l=n.querySelector(".cards__like");r.textContent=e.name,o.src=e.link,o.alt=e.name,n.id=e._id;var s,d,f=n.id,m=e.likes;return e.owner._id!==y?i.remove():i.addEventListener("click",(function(e){p=e.target.closest(".cards__item"),t(P)})),m.length>0&&(u.textContent=m.length),m.find((function(e){e._id}))&&l.classList.add("cards__like_active"),l.addEventListener("click",(function(){l.classList.contains("cards__like_active")?function(e,t,n){return(r=t,fetch("".concat(c.baseUrl,"/cards/likes/").concat(r),{headers:c.headers,method:"DELETE"}).then(a)).then((function(t){0===t.likes.length?n.textContent="":n.textContent=t.likes.length,e.classList.remove("cards__like_active")})).catch((function(e){console.log("При дизлайке карточки возникла ошибка, ".concat(e))}));var r}(l,f,u):function(e,t,n){return(r=t,fetch("".concat(c.baseUrl,"/cards/likes/").concat(r),{headers:c.headers,method:"PUT"}).then(a)).then((function(t){n.textContent=t.likes.length,e.classList.add("cards__like_active")})).catch((function(e){console.log("При лайке карточки возникла ошибка, ".concat(e))}));var r}(l,f,u)})),s=e.name,d=e.link,o.addEventListener("click",(function(){t(T),w.src=d,w.alt=s,B.textContent=s})),n}(e);E.prepend(n)}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var y,_=document.querySelector(".profile__name"),h=document.querySelector(".profile__description"),b=document.querySelector(".profile__avatar"),S=document.querySelector(".profile__avatar-edit"),q=document.querySelector(".profile__editor"),g=document.querySelector(".profile__add-mesto"),E=document.querySelector(".cards"),C=document.querySelector("#profile__popup"),L=C.querySelector(".popup__form"),k=document.querySelector("#username-input"),A=document.querySelector("#description-input"),x=document.querySelector("#cards-popup"),O=x.querySelector(".popup__form"),U=document.querySelector("#place-name-input"),j=document.querySelector("#place-image-input"),T=document.querySelector("#image-popup"),w=T.querySelector(".popup__image"),B=T.querySelector(".popup__description"),P=document.querySelector("#delete-card"),D=P.querySelector(".popup__form"),I=document.querySelector("#avatar-popup"),M=I.querySelector(".popup__form"),N=document.querySelector("#avatar-input"),J=document.querySelectorAll(".popup__close"),H=document.querySelectorAll(".popup"),V=document.querySelector("#card-template");function z(e,t){if(e)return t.textContent="Сохранение...",void t.setAttribute("disabled","");t.textContent="Сохранить",t.classList.add(i.disabledBtnClass),t.removeAttribute("disabled","")}S.addEventListener("click",(function(){t(I),l(M),f()})),q.addEventListener("click",(function(){t(C),l(L),f(),k.value=_.textContent,A.value=h.textContent})),g.addEventListener("click",(function(){t(x),l(O),f()})),J.forEach((function(e,t){e.addEventListener("click",(function(){n(H[t])}))})),O.addEventListener("submit",(function(e){e.preventDefault();var t=e.submitter,r=U.value,o=j.value;z(!0,t),function(e,t){return fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers,method:"POST",body:JSON.stringify({name:e,link:t})}).then(a)}(r,o).then((function(t){m(t),e.target.reset(),n(x)})).catch((function(n){console.log("При добавлении карточки возникла ошибка, ".concat(n)),e.submitter.classList.add(i.disableBtnClass),t.setAttribute("disabled","")})).finally((function(){z(!1,t)}))})),L.addEventListener("submit",(function(e){e.preventDefault();var t,r,o=e.submitter;z(!0,o),(t=k.value,r=A.value,fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers,method:"PATCH",body:JSON.stringify({name:t,about:r})}).then(a)).then((function(t){_.textContent=t.name,h.textContent=t.about,e.target.reset(),n(C)})).catch((function(e){console.log("При редактировании профиля возникла ошибка, ".concat(e))})).finally((function(){z(!1,o)}))})),M.addEventListener("submit",(function(e){e.preventDefault();var t,r=e.submitter;z(!0,r),(t=N.value,fetch("".concat(c.baseUrl,"/users/me/avatar"),{headers:c.headers,method:"PATCH",body:JSON.stringify({avatar:t})}).then(a)).then((function(t){b.src=t.avatar,e.target.reset(),n(I)})).catch((function(e){console.log("При обновлении аватара возникла ошибка, ".concat(e))})).finally((function(){z(!1,r)}))})),D.addEventListener("submit",(function(e){e.preventDefault();var t,r=e.submitter;return z(!0,r),(t=p.id,fetch("".concat(c.baseUrl,"/cards/").concat(t),{headers:c.headers,method:"DELETE"}).then(a)).then((function(){p.remove(),n(P)})).catch((function(e){console.log("При удалении карточки возникла ошибка, ".concat(e))})).finally((function(){z(!1,r)}))})),Promise.all([fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then(a),fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then(a)]).then((function(e){var t,n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(n,r)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];t=c,_.textContent=t.name,h.textContent=t.about,b.src=t.avatar,y=c._id,Array.from(a).reverse().forEach(m)})).catch((function(e){console.log("Возникла глобальная ошибка, ".concat(e))}))})();